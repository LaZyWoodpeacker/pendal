### Начальное техническое задание на реализацию расширения для 1С

1. На хук приходит запрос

POST /createbid

```json
{
  "bidId": "<Номер заказа>",
  "seller": {
    "name": "<Название поставщика>",
    "inn": "<ИНН поставщика>",
    "kpp": "<КПП поставщика>",
    "bank": {
      "bic": "<БИК>",
      "corNumber": "<Номер корреспондентского счёта>",
      "number": "<Номер счёта>",
      "name": "<Название банка>"
    }
  },
  "bayer": [
    {
      "name": "<Название покупателя>",
      "inn": "<ИНН покупателя>",
      "kpp": "<КПП покупателя>",
      "bank": {
        "bic": "<БИК>",
        "corNumber": "<Номер корреспондентского счёта>",
        "number": "<Номер счёта>",
        "name": "<Название банка>"
      }
    }
  ],
  "lead_products": [
    {
      "name": "<Название продукта>",
      "quantity": "<Количество>",
      "price": "<Цена>",
      "nds": "<Ставка ндс>"
    }
  ]
}
```

2. На основании данных сайта в 1с формируется _ЗаявкаМаркетплейса_ с реквизитами

   - Номер заявки
   - Поставщик
     - ИНН/КПП
     - Реквизиты счёта
     - Есть соглашение об ЭДО
   - Покупатель
     - ИНН/КПП
     - Реквизиты счёта
     - Есть соглашение об ЭДО
   - Агент
     - Наши реквизиты
   - Табличная часть
     - Наименование товара
     - Количество
     - Цена за единицу
     - ставка НДС/Без НДС
       - На основании таблицы вычисляются
       - Сумма
       - Сумма с НДС
       - Сумма без НДС

3. По ИНН и КПП проверяется есть ли у нас соглашение об ЭДО для поставщика и покупателя

   - Если нет отправляются приглашения об участии
   - Дожидаемся ответа от контрагентов

4. Создаём контрагента на основании данных из заявки

5. По факту оплаты на эндпоинт приходит запрос

POST /bidpaid

```json
{
  "bidId": "<номер заявки>"
}
```

6. По номеру заявки находим _ЗаявкаМаркетплейса_
   - Формируем УПД в статусе 1 и отправляем через Диадок покупателю
   - Копию в (pdf/xml) и инструкции для отчётности отправляем через Диадок поставщику

POST /bidcompleted

```json
{
  "bidId": "<номер заявки>"
}
```

7. Документ проводится

   - регистрируется в журнале учёта счетов-фактур

8. Формируются Отчёт агента и УПД на комиссию отправляются в диадок продавцу

   - В УПД контрагент поставщик
